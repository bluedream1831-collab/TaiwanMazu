<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<!-- é—œéµè¨­å®šï¼šç¦æ­¢ç¸®æ”¾ï¼Œé©æ‡‰è¢å¹•å¯¬åº¦ï¼Œé‡å°æ‰‹æ©Ÿå„ªåŒ– -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ç²‰ç´…è¶…è·‘ï¼šå…¨æ°‘é‘½è½åº• V5.0</title>
<style>
    /* å…¨å±€è¨­å®š */
    body, html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden; /* ç¦æ­¢æ²å‹• */
        background-color: #a1c4fd;
        font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
        touch-action: none; /* ç¦æ­¢ç€è¦½å™¨é è¨­è§¸æ§è¡Œç‚º */
        -webkit-user-select: none; /* ç¦æ­¢é¸å–æ–‡å­— */
        user-select: none;
    }

    /* éŠæˆ²å®¹å™¨ */
    #gameContainer {
        position: relative;
        overflow: hidden;
        background: #fdfbf7;
        /* é›»è…¦ç‰ˆè¨­å®šï¼šç¶­æŒè¦–çª—æ„Ÿ */
        width: 800px;
        height: 450px;
        margin: 0 auto;
        top: 50%;
        transform: translateY(-50%);
        border: 4px solid #fff;
        border-radius: 15px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    }

    /* æ‰‹æ©Ÿç‰ˆè¨­å®š (RWD)ï¼šå¼·åˆ¶å…¨è¢å¹• */
    @media (max-width: 820px) {
        #gameContainer {
            width: 100% !important;
            height: 100% !important;
            top: 0;
            transform: none;
            border: none;
            border-radius: 0;
            margin: 0;
        }
    }

    canvas { 
        display: block; 
        width: 100%;
        height: 100%;
    }
    
    /* éŠæˆ²èƒŒæ™¯æ¼¸å±¤èˆ‡æ¨¡å¼åˆ‡æ› */
    .bg-normal { background: linear-gradient(180deg, #a1c4fd 0%, #c2e9fb 100%); }
    .bg-fever { background: linear-gradient(180deg, #ff9a9e 0%, #fecfef 100%); }

    /* UI ä»‹é¢å±¤ */
    #uiLayer {
        position: absolute;
        top: 20px;
        left: 20px;
        color: #e84393;
        font-size: clamp(24px, 5vw, 36px); /* å­—é«”å¤§å°éš¨è¢å¹•ç¸®æ”¾ */
        font-weight: 900;
        text-shadow: 2px 2px 0 #fff;
        z-index: 10;
        pointer-events: none;
    }

    #feverText {
        position: absolute;
        top: 15%;
        width: 100%;
        text-align: center;
        font-size: clamp(30px, 8vw, 50px);
        color: #d63031;
        font-weight: bold;
        text-shadow: 3px 3px 0 #fff, 0 0 20px rgba(255,215,0,0.8);
        display: none;
        animation: pulse 0.5s infinite alternate;
        pointer-events: none;
        z-index: 15;
    }

    /* é–‹å§‹èˆ‡çµæŸç•«é¢ */
    .screen {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: rgba(255, 255, 255, 0.9);
        text-align: center;
        color: #e84393;
        z-index: 20;
        backdrop-filter: blur(5px);
    }

    h1 { 
        margin: 0 0 10px 0; 
        font-size: clamp(28px, 6vw, 40px); 
        text-shadow: 2px 2px 0px #ffeaa7; 
    }
    
    p { 
        font-size: clamp(16px, 4vw, 20px); 
        color: #555; 
        font-weight: bold; 
        margin-bottom: 25px; 
        padding: 0 20px;
    }

    /* å¤§æŒ‰éˆ•ï¼Œæ–¹ä¾¿æ‰‹æ©Ÿé»æ“Š */
    button {
        background: linear-gradient(to bottom, #ff9ff3, #f368e0);
        color: white;
        border: none;
        padding: 15px 50px;
        font-size: 24px;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 6px 0 #c445b0;
        font-weight: bold;
        transition: transform 0.1s;
        -webkit-tap-highlight-color: transparent; /* ç§»é™¤æ‰‹æ©Ÿé»æ“Šè—æ¡† */
    }
    button:active { transform: translateY(6px); box-shadow: 0 0 0 #c445b0; }
    
    @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.1); } }

    /* æ‰‹æ©Ÿç›´å‘æç¤º (é¸ç”¨) */
    .rotate-hint {
        display: none;
        font-size: 12px;
        color: #888;
        margin-top: 10px;
    }
</style>
</head>
<body>

<div id="gameContainer" class="bg-normal">
    <canvas id="gameCanvas"></canvas>
    
    <div id="uiLayer">ç¦æ°£: <span id="score">0</span></div>
    <div id="feverText">ğŸ™ é‘½è½åº•ä¿å¹³å®‰ ğŸ™<br><span style="font-size:0.6em">è¡æ’ä¿¡å¾’åŠ åˆ†ï¼</span></div>
    
    <div id="startScreen" class="screen">
        <div style="font-size:60px; margin-bottom:10px">ğŸšğŸ’¨</div>
        <h1>ç²‰ç´…è¶…è·‘ V5.0</h1>
        <p>æ‰‹æ©Ÿå…¨è¢å¹•ç‰ˆï¼<br>æ‰‹æŒ‡æŒ‰ä½è¢å¹•ä¸Šä¸‹æ»‘å‹•</p>
        <p style="font-size:0.8em; color:#d63031">æ”¶é›†é‡‘çˆ âš±ï¸ é–‹å•Ÿç„¡æ•µé‘½è½åº•ï¼</p>
        <button onclick="startGame()">èµ·é§•å‡ºç™¼</button>
        <div class="rotate-hint">ğŸ’¡ æ©«è‘—ç©è¦–é‡æ›´å¯¬å–”ï¼</div>
    </div>

    <div id="gameOverScreen" class="screen" style="display: none;">
        <h1>ğŸ™ åœ“æ»¿é§é§• ğŸ™</h1>
        <p>æœ¬æ¬¡ç´¯ç©ç¦æ°£</p>
        <h2 style="font-size: 60px; margin: 10px 0; color: #d63031;" id="finalScore">0</h2>
        <button onclick="startGame()">å†æ¬¡èµ·é§•</button>
    </div>
</div>

<script>
    const container = document.getElementById('gameContainer');
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const finalScoreEl = document.getElementById('finalScore');
    const feverText = document.getElementById('feverText');

    let gameRunning = false;
    let score = 0;
    let frames = 0;
    let gameSpeed = 4;
    
    // Fever æ¨¡å¼è®Šæ•¸
    let isFeverMode = false;
    let feverTimer = 0;
    const FEVER_DURATION = 350;

    // --- é—œéµä¿®æ”¹ï¼šRWD ç•«å¸ƒå°ºå¯¸è™•ç† ---
    function resizeCanvas() {
        // å–å¾—å®¹å™¨å¯¦éš›å¤§å° (æ‰‹æ©Ÿä¸Šæ˜¯å…¨è¢å¹•ï¼Œé›»è…¦ä¸Šæ˜¯å›ºå®šæ¡†)
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        // ç‚ºäº†é¿å…é«˜è§£æåº¦æ‰‹æ©Ÿ(Retina)æ¨¡ç³Šï¼Œå¯ä»¥è¨­å®š 2 å€åƒç´ 
        // é€™è£¡ç‚ºäº†æ•ˆèƒ½å…ˆä½¿ç”¨ 1:1ï¼Œä½†ç¢ºä¿ fillStyle å¡«æ»¿
        canvas.width = width;
        canvas.height = height;
    }
    // ç›£è½è¦–çª—æ”¹è®Š (æ—‹è½‰æ‰‹æ©Ÿæ™‚è§¸ç™¼)
    window.addEventListener('resize', () => {
        resizeCanvas();
        // å¦‚æœæ­£åœ¨ç©ï¼Œé‡ç½®åª½ç¥–ä½ç½®é¿å…è·‘åˆ°è¢å¹•å¤–
        if(gameRunning) {
            player.y = canvas.height / 2;
            player.targetY = canvas.height / 2;
        }
    });
    // åˆå§‹åŒ–
    resizeCanvas();

    // --- ç²’å­ç‰¹æ•ˆ ---
    const particles = [];
    class Particle {
        constructor(x, y, color) {
            this.x = x;
            this.y = y;
            this.size = Math.random() * 8 + 3; // æ‰‹æ©Ÿä¸Šç²’å­å¤§ä¸€é»æ¯”è¼ƒå¥½çœ‹
            this.speedX = Math.random() * 8 - 4;
            this.speedY = Math.random() * 8 - 4;
            this.color = color;
            this.life = 1;
        }
        update() {
            this.x += this.speedX;
            this.y += this.speedY;
            this.life -= 0.04;
            this.size *= 0.9;
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.globalAlpha = Math.max(0, this.life);
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
            ctx.fill();
            ctx.globalAlpha = 1;
        }
    }

    // --- ç²‰ç´…è¶…è·‘ä¸»è§’ ---
    const player = {
        x: 0, // åœ¨ draw è¨­å®š
        y: 0,
        baseX: 0.15, // ç›¸å° X ä½ç½® (ç•«é¢å¯¬åº¦çš„ 15%)
        width: 80, 
        height: 60,
        targetY: 0,
        draw: function() {
            // RWD X è»¸ä½ç½®èª¿æ•´
            this.x = canvas.width * this.baseX;

            ctx.save();
            ctx.translate(this.x, this.y);
            
            // æ™ƒå‹•
            const bounceSpeed = isFeverMode ? 0.6 : 0.3;
            const bounce = Math.sin(frames * bounceSpeed) * 3;
            ctx.translate(0, bounce);

            // ç¹ªè£½é †åºï¼šé™°å½± -> æ£å­ -> è½èº« -> å¸ƒç°¾ -> è£é£¾
            
            // é™°å½±
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath(); ctx.ellipse(0, 35, 30, 8, 0, 0, Math.PI*2); ctx.fill();

            // è½æ£
            ctx.fillStyle = '#f1c40f'; ctx.fillRect(-35, 10, 70, 6);

            // è½èº«ç™¼å…‰
            if (isFeverMode) { ctx.shadowColor = '#ffeaa7'; ctx.shadowBlur = 25; }
            
            // è½èº« (ç²‰ç´…é ‚è“‹)
            ctx.fillStyle = '#ff9ff3'; 
            ctx.beginPath();
            ctx.moveTo(-25, 10); ctx.lineTo(25, 10); ctx.lineTo(30, -15); 
            ctx.quadraticCurveTo(0, -25, -30, -15);
            ctx.fill();
            ctx.shadowBlur = 0;

            // å¸ƒç°¾
            ctx.fillStyle = '#fdcb6e'; ctx.fillRect(-20, 10, 40, 20);
            
            // ç¹¡çƒ
            ctx.fillStyle = '#d63031'; ctx.beginPath(); ctx.arc(0, -20, 6, 0, Math.PI*2); ctx.fill();
            
            // å‹‡å­—
            ctx.fillStyle = 'red'; ctx.font = 'bold 14px Arial'; ctx.textAlign = 'center'; ctx.fillText('å‹‡', 0, 24);

            ctx.restore();
        },
        update: function() {
            // å¹³æ»‘è·Ÿéš¨
            this.y += (this.targetY - this.y) * 0.2; // 0.2 ä¿‚æ•¸è®“åæ‡‰æ›´éˆæ•
            
            // é‚Šç•Œé™åˆ¶
            if(this.y < 40) this.targetY = 40;
            if(this.y > canvas.height - 40) this.targetY = canvas.height - 40;
        }
    };

    // --- é“å…· ---
    const items = [];
    const itemTypes = [
        { emoji: 'ğŸ®', type: 'good', points: 10, size: 40, color: '#e17055' },
        { emoji: 'ğŸ‘', type: 'good', points: 20, size: 40, color: '#ff7675' },
        { emoji: 'ğŸ’¥', type: 'bad', points: 0, size: 35 }, 
        { emoji: 'âš±ï¸', type: 'trigger', points: 50, size: 45, color: '#fdcb6e' } 
    ];
    const believerItem = { emoji: 'ğŸ™‡', type: 'fever', points: 50, size: 45, color: '#ffeaa7' };

    class Item {
        constructor(forceType = null) {
            if (forceType) {
                this.typeData = forceType;
            } else {
                let rand = Math.random();
                if (rand < 0.05) this.typeData = itemTypes[3]; // é‡‘çˆ
                else if (rand < 0.35) this.typeData = itemTypes[2]; // ç‚¸å½ˆ
                else if (rand < 0.65) this.typeData = itemTypes[1];
                else this.typeData = itemTypes[0];
            }

            this.x = canvas.width + 50;
            
            // æ ¹æ“šç•«å¸ƒé«˜åº¦æ±ºå®šç”Ÿæˆä½ç½®
            if (this.typeData.type === 'fever') {
                // ä¿¡å¾’ç¨å¾®åä¸‹
                 this.y = Math.random() * (canvas.height * 0.6) + (canvas.height * 0.3);
            } else {
                 this.y = Math.random() * (canvas.height - 80) + 40;
            }
            
            this.speed = gameSpeed + Math.random() * 2;
            this.markedForDeletion = false;
        }
        draw() {
            ctx.font = `${this.typeData.size}px serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(this.typeData.emoji, this.x, this.y);
        }
        update() {
            let currentSpeed = isFeverMode ? this.speed + 4 : this.speed;
            this.x -= currentSpeed;
            if (this.x < -50) this.markedForDeletion = true;

            const dist = Math.hypot(this.x - player.x, this.y - player.y);
            // æ‰‹æ©Ÿç‰ˆç¢°æ’å¯¬å®¹åº¦ç¨å¾®å¤§ä¸€é» (50)
            if (dist < 50) {
                if (this.typeData.type === 'bad') {
                    if (!isFeverMode) endGame(); 
                } 
                else if (this.typeData.type === 'trigger') {
                    startFeverMode();
                    this.markedForDeletion = true;
                    createExplosion(this.x, this.y, '#fdcb6e');
                }
                else {
                    score += this.typeData.points;
                    scoreEl.innerText = score;
                    this.markedForDeletion = true;
                    createExplosion(this.x, this.y, this.typeData.color);
                    if(score % 100 === 0) gameSpeed += 0.5;
                }
            }
        }
    }

    function createExplosion(x, y, color) {
        for(let i=0; i<12; i++){
            particles.push(new Particle(x, y, color));
        }
    }

    function startFeverMode() {
        if (isFeverMode) { feverTimer = FEVER_DURATION; return; }
        isFeverMode = true;
        feverTimer = FEVER_DURATION;
        container.classList.remove('bg-normal');
        container.classList.add('bg-fever');
        feverText.style.display = 'block';
        items.forEach(item => { if(item.typeData.type === 'bad') item.markedForDeletion = true; });
    }

    function endFeverMode() {
        isFeverMode = false;
        container.classList.remove('bg-fever');
        container.classList.add('bg-normal');
        feverText.style.display = 'none';
    }

    // --- é€Ÿåº¦ç·šèƒŒæ™¯ ---
    const lines = [];
    class SpeedLine {
        constructor() {
            this.reset();
        }
        reset() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.width = Math.random() * 20 + 10;
            this.speed = Math.random() * 10 + 5;
        }
        update() {
            let s = isFeverMode ? (this.speed + gameSpeed) * 1.5 : this.speed + gameSpeed;
            this.x -= s;
            if(this.x < -50) {
                this.x = canvas.width;
                this.y = Math.random() * canvas.height;
            }
        }
        draw() {
            ctx.fillStyle = isFeverMode ? 'rgba(255, 255, 255, 0.6)' : 'rgba(255, 255, 255, 0.4)';
            ctx.fillRect(this.x, this.y, this.width, isFeverMode ? 4 : 2);
        }
    }
    for(let i=0; i<15; i++) lines.push(new SpeedLine());

    // --- æ“ä½œç›£è½ (æ‰‹æ©Ÿ+é›»è…¦) ---
    const keys = {};
    document.addEventListener('keydown', e => keys[e.code] = true);
    document.addEventListener('keyup', e => keys[e.code] = false);

    // æ‰‹æ©Ÿè§¸æ§ï¼šä½¿ç”¨æ•´å€‹ container
    container.addEventListener('touchstart', handleTouch, {passive: false});
    container.addEventListener('touchmove', handleTouch, {passive: false});
    
    function handleTouch(e) {
        if (!gameRunning) return;
        e.preventDefault(); // ç¦æ­¢ç€è¦½å™¨æ»‘å‹•
        
        // å–å¾—è§¸æ§é»ç›¸å°æ–¼ Canvas çš„ä½ç½®
        const rect = canvas.getBoundingClientRect();
        const touchY = e.touches[0].clientY - rect.top;
        
        // ç›´æ¥è¨­å®šç›®æ¨™ä½ç½®ï¼Œè®“åª½ç¥–è·Ÿæ‰‹
        player.targetY = touchY;
    }

    // --- éŠæˆ²è¿´åœˆ ---
    function animate() {
        if (!gameRunning) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        lines.forEach(line => { line.update(); line.draw(); });

        if (keys.ArrowUp) player.targetY -= 9; // é›»è…¦æŒ‰éµé€Ÿåº¦
        if (keys.ArrowDown) player.targetY += 9;
        player.update();
        player.draw();

        // é“å…·ç”Ÿæˆ
        let spawnRate = isFeverMode ? 8 : Math.max(20, 60 - gameSpeed*1.5);
        if (frames % spawnRate === 0) {
            if (isFeverMode) items.push(new Item(believerItem));
            else items.push(new Item());
        }

        for (let i = items.length - 1; i >= 0; i--) {
            items[i].update();
            items[i].draw();
            if (items[i].markedForDeletion) items.splice(i, 1);
        }

        for (let i = particles.length - 1; i >= 0; i--) {
            particles[i].update();
            particles[i].draw();
            if (particles[i].life <= 0) particles.splice(i, 1);
        }

        if (isFeverMode) {
            feverTimer--;
            if (feverTimer <= 0) endFeverMode();
        }

        frames++;
        requestAnimationFrame(animate);
    }

    function startGame() {
        resizeCanvas(); // ç¢ºä¿å°ºå¯¸æ­£ç¢º
        gameRunning = true;
        score = 0;
        frames = 0;
        gameSpeed = 5; // æ‰‹æ©Ÿç‰ˆç¨å¾®å¿«ä¸€é»é»æ¯”è¼ƒåˆºæ¿€
        items.length = 0;
        particles.length = 0;
        isFeverMode = false;
        container.classList.remove('bg-fever');
        container.classList.add('bg-normal');
        feverText.style.display = 'none';
        
        scoreEl.innerText = score;
        
        // åˆå§‹ä½ç½®è¨­å®šåœ¨ç•«é¢ä¸­é–“
        player.y = canvas.height / 2;
        player.targetY = canvas.height / 2;
        
        startScreen.style.display = 'none';
        gameOverScreen.style.display = 'none';
        animate();
    }

    function endGame() {
        gameRunning = false;
        finalScoreEl.innerText = score;
        gameOverScreen.style.display = 'flex';
        container.classList.remove('bg-fever');
        feverText.style.display = 'none';
    }
</script>
</body>
</html>
